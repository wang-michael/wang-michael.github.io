## Java虚拟机学习

1、	Java内存模型与Java运行时数据区对比
Java内存模型：java虚拟机规范中试图定义一种Java内存模型来屏蔽掉各种硬件和操作系统的内存访问差异，以实现让Java并发程序在各种平台下都能达到一致的内存访问效果。(在此之前，主流程序语言比如c、c++直接使用物理硬件和操作系统的内存模型，因此，会由于不同平台上内存模型的差异，有可能导致程序在一套平台上并发完全正常，而在另一套平台上并发访问却经常出错，因此在某些场景就必须针对不同的平台来编写程序。)
Java内存模型中有一系列的规定(比如原子性可见性有序性等的规定)，致力于解决上述的并发程序不同平台上不兼容的问题，这个规定是由JVM来实现的，不同平台下的JVM有不同的实现方式，但在上层Java开发人员的眼中，他们都是一致的，因为他们都符合Java内存模型的规定。 
Java运行时数据区：Java虚拟机规定JVM在执行java程序的过程中会把它所管理的内存划分为若干个不同的数据区域。这些区域都有各自的用途，以及创建和销毁的时间，有的区域随着虚拟机进程的启动而存在(比如堆区)，有的依赖用户线程的启动和销毁而建立和销毁(比如虚拟机栈)。
Java虚拟机帮助运行在其上的Java进程完成内存管理操作，可以理解为Java虚拟机在启动时向os 通过malloc操作申请了一大块内存，之后运行在其上的java进程使用的内存就由jvm来管理，当jvm发现可用的内存不够的时候，就进行垃圾收集操作，如果还不够，就再向os申请内存。
通过Java运行时数据区完成的内存管理操作是符合Java内存模型的。
JAVA内存模型中涉及到的主内存和工作内存等概念与Java运行时数据区中的Java堆、栈、方法区等并不是同一个层次上的内存划分，这两者基本上是没有关系的，JMM是为了解决防止同一套并发程序不同平台上运行不兼容的问题(比如在编译时插入一些屏障指令防止os或硬件优化对指令重排序)；Java运行时数据区规定了各个厂家实现JVM时的进行内存管理的一套规范，各个厂家在实现这个规范的时候给出的最后JVM产品一定是满足JVM内存模型的。

JMM重点解决的问题是主内存与工作内存的交互的问题(不管主内存与工作内存在JVM中怎么实现)，Java运行时数据区重点解决的问题是主内存与工作内存在JVM中具体怎么实现的问题；JVM实现时通过JAVA编译器(比如在编译时插入一些屏障指令防止os或硬件优化对指令重排序)与Java运行时数据区的配合才可以满足JMM中的规定。

JMM中的主内存与工作内存如果一定要对应到Java运行时数据区中的话，可以认为主内存对应于Java堆中的对象实例数据部分(Java堆中对象除了对象实例数据，还包含对象的MarkWord、对象类型数据指针以及用于字节对其的数据填充)，而工作内存对应于虚拟机栈中的部分区域。
